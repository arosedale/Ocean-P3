<!-- Load libraries with error handling -->
<script>
function loadScript(src) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = src;
    script.onload = resolve;
    script.onerror = () => reject(new Error(`Failed to load ${src}`));
    document.head.appendChild(script);
  });
}

Promise.all([
  loadScript('https://unpkg.com/leaflet@1.7.1/dist/leaflet.js'),
  loadScript('https://cdn.jsdelivr.net/npm/chart.js'),
  loadScript('https://d3js.org/d3.v7.min.js')
]).catch(err => {
  console.error(err);
  document.getElementById('map').innerHTML = 
    '<p class="error">Failed to load required libraries. Please refresh.</p>';
});
</script>
